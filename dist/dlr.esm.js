/*!
 * Dynamsoft JavaScript Library
 * @product Dynamsoft Label Recognizer JS Edition
 * @website http://www.dynamsoft.com
 * @copyright Copyright 2023, Dynamsoft Corporation
 * @author Dynamsoft
 * @version 2.2.31 (js 20230728)
 * @fileoverview Dynamsoft JavaScript Library for Label Recognizer
 * More info on DLR JS: https://www.dynamsoft.com/label-recognizer/sdk-javascript/
 */
import{Howl as e}from"dm-howler";const t="undefined"==typeof self,s=t?{}:self;let r,i,n,a,o;if("undefined"!=typeof navigator&&(r=navigator,i=r.userAgent,n=r.platform,a=r.mediaDevices),!t){const e={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:r.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},t={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:n,search:"Win"},Mac:{str:n},Linux:{str:n}};let s="unknownBrowser",a=0,l="unknownOS";for(let t in e){const r=e[t]||{};let n=r.str||i,o=r.search||t,l=r.verStr||i,c=r.verSearch||t;if(c instanceof Array||(c=[c]),-1!=n.indexOf(o)){s=t;for(let e of c){let t=l.indexOf(e);if(-1!=t){a=parseFloat(l.substring(t+e.length+1));break}}break}}for(let e in t){const s=t[e]||{};let r=s.str||i,n=s.search||e;if(-1!=r.indexOf(n)){l=e;break}}"Linux"==l&&-1!=i.indexOf("Windows NT")&&(l="HarmonyOS"),o={browser:s,version:a,OS:l}}t&&(o={browser:"ssr",version:0,OS:"ssr"});const l="undefined"!=typeof WebAssembly&&i&&!(/Safari/.test(i)&&!/Chrome/.test(i)&&/\(.+\s11_2_([2-6]).*\)/.test(i)),c=!("undefined"==typeof Worker),h=!(!a||!a.getUserMedia),u=async()=>{let e=!1;if(h)try{(await a.getUserMedia({video:!0})).getTracks().forEach((e=>{e.stop()})),e=!0}catch(e){}return e};"Chrome"===o.browser&&o.version>66||"Safari"===o.browser&&o.version>13||"OPR"===o.browser&&o.version>43||"Edge"===o.browser&&o.version;const d=(()=>{if(!t&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"})(),g=" is not allowed to change after `createInstance` or `loadWasm` is called.",_=!t&&document.currentScript&&(document.currentScript.getAttribute("data-license")||document.currentScript.getAttribute("data-productKeys")||document.currentScript.getAttribute("data-licenseKey")||document.currentScript.getAttribute("data-handshakeCode")||document.currentScript.getAttribute("data-organizationID"))||"",f=!t&&document.currentScript&&document.currentScript.getAttribute("data-sessionPassword")||"",R=e=>{if(null==e)e=[];else{e=e instanceof Array?[...e]:[e];for(let s=0;s<e.length;++s){if(!t){let t=document.createElement("a");t.href=e[s],e[s]=t.href}e[s].endsWith("/")||(e[s]+="/")}}return e},m=e=>e&&"object"==typeof e&&"function"==typeof e.then;class p extends Promise{constructor(e){let t,s;super(((e,r)=>{t=e,s=r})),this._s="pending",this.resolve=e=>{this.isPending&&(m(e)?this.task=e:(this._s="fulfilled",t(e)))},this.reject=e=>{this.isPending&&(this._s="rejected",s(e))},this.task=e}get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(e){let t;this._task=e,m(e)?t=e:"function"==typeof e&&(t=new Promise(e)),t&&(async()=>{try{const s=await t;e===this._task&&this.resolve(s)}catch(t){e===this._task&&this.reject(t)}})()}get isEmpty(){return null==this._task}}var S,A,w,y,I;function L(e){return!(!e||"object"!=typeof e||Array.isArray(e))&&"getImage"in e}function E(e){return!(!e||"object"!=typeof e||Array.isArray(e))&&("data"in e&&("width"in e&&("height"in e&&"pixelFormat"in e)))}function b(e){return!(!e||"object"!=typeof e||Array.isArray(e))&&("data"in e&&("region"in e&&("sx"in e&&("sy"in e&&("width"in e&&("height"in e&&("colorMode"in e&&("timeSpent"in e&&("timeStamp"in e&&("isCropped"in e&&("toCanvas"in e&&("_sWidth"in e&&("_sHeight"in e&&"_bUseWebGL"in e)))))))))))))}!function(e){e[e.IPF_BINARY=0]="IPF_BINARY",e[e.IPF_BINARYINVERTED=1]="IPF_BINARYINVERTED",e[e.IPF_GRAYSCALED=2]="IPF_GRAYSCALED",e[e.IPF_NV21=3]="IPF_NV21",e[e.IPF_RGB_565=4]="IPF_RGB_565",e[e.IPF_RGB_555=5]="IPF_RGB_555",e[e.IPF_RGB_888=6]="IPF_RGB_888",e[e.IPF_ARGB_8888=7]="IPF_ARGB_8888",e[e.IPF_RGB_161616=8]="IPF_RGB_161616",e[e.IPF_ARGB_16161616=9]="IPF_ARGB_16161616",e[e.IPF_ABGR_8888=10]="IPF_ABGR_8888",e[e.IPF_ABGR_16161616=11]="IPF_ABGR_16161616",e[e.IPF_BGR_888=12]="IPF_BGR_888"}(S||(S={})),function(e){e[e.OK=0]="OK",e[e.UNKNOWN=-1e4]="UNKNOWN",e[e.NO_MEMORY=-10001]="NO_MEMORY",e[e.NULL_POINTER=-10002]="NULL_POINTER",e[e.LICENSE_INVALID=-10003]="LICENSE_INVALID",e[e.LICENSE_EXPIRED=-10004]="LICENSE_EXPIRED",e[e.FILE_NOT_FOUND=-10005]="FILE_NOT_FOUND",e[e.FILETYPE_NOT_SUPPORTED=-10006]="FILETYPE_NOT_SUPPORTED",e[e.BPP_NOT_SUPPORTED=-10007]="BPP_NOT_SUPPORTED",e[e.IMAGE_READ_FAILED=-10012]="IMAGE_READ_FAILED",e[e.TIFF_READ_FAILED=-10013]="TIFF_READ_FAILED",e[e.PDF_READ_FAILED=-10021]="PDF_READ_FAILED",e[e.PDF_DLL_MISSING=-10022]="PDF_DLL_MISSING",e[e.RECOGNITION_TIMEOUT=-10026]="RECOGNITION_TIMEOUT",e[e.JSON_PARSE_FAILED=-10030]="JSON_PARSE_FAILED",e[e.JSON_TYPE_INVALID=-10031]="JSON_TYPE_INVALID",e[e.JSON_KEY_INVALID=-10032]="JSON_KEY_INVALID",e[e.JSON_VALUE_INVALID=-10033]="JSON_VALUE_INVALID",e[e.JSON_NAME_KEY_MISSING=-10034]="JSON_NAME_KEY_MISSING",e[e.JSON_NAME_VALUE_DUPLICATED=-10035]="JSON_NAME_VALUE_DUPLICATED",e[e.TEMPLATE_NAME_INVALID=-10036]="TEMPLATE_NAME_INVALID",e[e.PARAMETER_VALUE_INVALID=-10038]="PARAMETER_VALUE_INVALID",e[e.SET_MODE_ARGUMENT_ERROR=-10051]="SET_MODE_ARGUMENT_ERROR",e[e.GET_MODE_ARGUMENT_ERROR=-10055]="GET_MODE_ARGUMENT_ERROR",e[e.CHARACTER_MODEL_FILE_NOT_FOUND=-10100]="CHARACTER_MODEL_FILE_NOT_FOUND"}(A||(A={})),function(e){e[e.LST_MANUAL_SPECIFICATION=1]="LST_MANUAL_SPECIFICATION",e[e.LST_PREDETECTED_REGION=2]="LST_PREDETECTED_REGION",e[e.LST_BARCODE=4]="LST_BARCODE"}(w||(w={}));class C{constructor(){this._instanceID=void 0,this.oriCanvas=null,this.oriCanvasData=null,this._ifSaveOriginalImageInACanvas=!1,this.canvas=null,this._region=null,this._timeStartRecognize=null,this._timeEnterInnerDLR=null,this.recognizeRecords={},this.drawRegionsultRecords={},this.bDestroyed=!1,this._setWarnnedEx=new Set,this._lastErrorCode=0,this._lastErrorString="",this._lastInnerDecodeDuration=0,this.intervalTime=0,this._intervalGetVideoFrame=0,this._idCardUpperLine="",this.array_getFrameTimeCost=[],this.array_decodeFrameTimeCost=[],this._arrPolygons=[],this._bPauseScan=!1,this._intervalDetectVideoPause=1e3,this.captureAndRecognizeInParallel=!0,this._selMinLtr=null,this._optGotMinLtr=null,this._minLetter=0,this._soundSource="data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA/+M4wAAAAAAAAAAAAEluZm8AAAAPAAAABQAAAkAAgICAgICAgICAgICAgICAgICAgKCgoKCgoKCgoKCgoKCgoKCgoKCgwMDAwMDAwMDAwMDAwMDAwMDAwMDg4ODg4ODg4ODg4ODg4ODg4ODg4P//////////////////////////AAAAAExhdmM1OC41NAAAAAAAAAAAAAAAACQEUQAAAAAAAAJAk0uXRQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+MYxAANQAbGeUEQAAHZYZ3fASqD4P5TKBgocg+Bw/8+CAYBA4XB9/4EBAEP4nB9+UOf/6gfUCAIKyjgQ/Kf//wfswAAAwQA/+MYxAYOqrbdkZGQAMA7DJLCsQxNOij///////////+tv///3RWiZGBEhsf/FO/+LoCSFs1dFVS/g8f/4Mhv0nhqAieHleLy/+MYxAYOOrbMAY2gABf/////////////////usPJ66R0wI4boY9/8jQYg//g2SPx1M0N3Z0kVJLIs///Uw4aMyvHJJYmPBYG/+MYxAgPMALBucAQAoGgaBoFQVBUFQWDv6gZBUFQVBUGgaBr5YSgqCoKhIGg7+IQVBUFQVBoGga//SsFSoKnf/iVTEFNRTMu/+MYxAYAAANIAAAAADEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",this.beepSound=new e({src:[this._soundSource],onplayerror:(e,t)=>{console.warn(`Sound '${e}' playback failure: ${t}`)}}),this.bPlaySoundOnSuccessfulRead=!1,this.bVibrateOnSuccessfulRead=!1,this.vibrateDuration=300,this.highlightFillStyle="rgba(254,180,32,0.3)",this.highlightStrokeStyle="rgba(254,180,32,0.9)",this._vinResultArray=[],this.currentSettingsTemplate="cppdefault",this._dce=null,this.imgSource=null,this._maxCvsSideLength=["iPhone","Android","HarmonyOS"].includes(C.browserInfo.OS)?2048:4096,this.presetVideoTemplateRegion={regionLeft:0,regionRight:100,regionTop:40,regionBottom:60,regionMeasuredByPercentage:!0},this._onMinLetterSelChange=async e=>{let t=e.target.value;if("got"===t)return;t=JSON.parse(t);let s=JSON.parse(await this.outputRuntimeSettingsToString());s.LabelRecognizerParameterArray[0].LineStringLengthRange=[t,999],s.TextAreaArray[0].LineStringLengthRange=[t,999],await this.updateRuntimeSettingsFromString(s)},this._promiseStartScan=null}static getVersion(){return this._version}static get license(){return this._license}static set license(e){((e,t)=>{const s=e;if(!s._pLoad.isEmpty)throw new Error("`license`"+g);s._license=t})(C,e)}static initLicense(e){C.license=e}static set sessionPassword(e){((e,t)=>{const s=e;if(!s._pLoad.isEmpty)throw new Error("`sessionPassword`"+g);s._sessionPassword=t})(C,e)}static get sessionPassword(){return this._sessionPassword}static async detectEnvironment(){return await(async()=>({wasm:l,worker:c,getUserMedia:h,camera:await u(),browser:o.browser,version:o.version,OS:o.OS}))()}static get engineResourcePath(){return this._engineResourcePath}static set engineResourcePath(e){if(!this._pLoad.isEmpty)throw new Error("`engineResourcePath` is not allowed to change after `createInstance` or `loadWasm` is called.");C._engineResourcePath=(e=>{if(null==e&&(e="./"),!t){let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e})(e)}static get licenseServer(){return this._licenseServer}static set licenseServer(e){((e,t)=>{const s=e;if(!s._pLoad.isEmpty)throw new Error("`licenseServer`"+g);s._licenseServer=R(t)})(C,e)}static get deviceFriendlyName(){return this._deviceFriendlyName}static set deviceFriendlyName(e){((e,t)=>{const s=e;if(!s._pLoad.isEmpty)throw new Error("`deviceFriendlyName`"+g);s._deviceFriendlyName=t||""})(C,e)}get ifSaveOriginalImageInACanvas(){return this._ifSaveOriginalImageInACanvas}set ifSaveOriginalImageInACanvas(e){this._ifSaveOriginalImageInACanvas=e}getOriginalImageInACanvas(){return!this.oriCanvas&&this.oriCanvasData?this.oriCanvasData.toCanvas():this.oriCanvas}set region(e){this._region=e}get region(){return this._region}static isWasmLoaded(){return this._pLoad.isFulfilled}isContextDestroyed(){return this.bDestroyed}static get lastErrorCode(){return this._lastErrorCode}static get lastErrorString(){return this._lastErrorString}get lastErrorCode(){return this._lastErrorCode}get lastErrorString(){return this._lastErrorString}static recalculateResultLocation(e,t,s,r,i,n,a){if(e.length>0&&e[0].lineResults.length>0)for(let o of e)for(let e of o.lineResults){let o=e.location.points,l=n/r,c=a/i;o[0].x=o[0].x/l+t,o[1].x=o[1].x/l+t,o[2].x=o[2].x/l+t,o[3].x=o[3].x/l+t,o[0].y=o[0].y/c+s,o[1].y=o[1].y/c+s,o[2].y=o[2].y/c+s,o[3].y=o[3].y/c+s}}static get defaultUIElementURL(){var e;return null===(e=this._defaultUIElementURL)||void 0===e?void 0:e.replace("@engineResourcePath/",C.engineResourcePath)}static set defaultUIElementURL(e){this._defaultUIElementURL=e}_updateMinLtrSel(e){if(this._minLetter=e,this._optGotMinLtr){const t=e?`${e}+ letters`:"any letter";this._optGotMinLtr.innerText=t,this._selMinLtr&&this._optGotMinLtr.parentNode==this._selMinLtr&&(this._selMinLtr.value="got")}}get soundSource(){return this._soundSource}set soundSource(t){this._soundSource=t,this.beepSound=new e({src:[this._soundSource],onplayerror:(e,t)=>{console.warn(`Sound '${e}' playback failure: ${t}`)}})}get whenToPlaySoundforSuccessfulRead(){return!0===this.bPlaySoundOnSuccessfulRead?"frame":this.bPlaySoundOnSuccessfulRead?this.bPlaySoundOnSuccessfulRead:"never"}set whenToPlaySoundforSuccessfulRead(e){this.bPlaySoundOnSuccessfulRead="never"!==e&&e}get whenToVibrateforSuccessfulRead(){return!0===this.bVibrateOnSuccessfulRead?"frame":this.bVibrateOnSuccessfulRead?this.bVibrateOnSuccessfulRead:"never"}set whenToVibrateforSuccessfulRead(e){this.bVibrateOnSuccessfulRead="never"!==e&&e}set dce(e){this._dce=e}get dce(){return!this._dce||this._dce.isDisposed?null:this._dce}set maxCvsSideLength(e){this._maxCvsSideLength=e,this._dceControler&&this._dceControler.setDisiredValue(this,"maxCvsSideLength",e)}get maxCvsSideLength(){return this._maxCvsSideLength}async _registerDCEControler(){if(!this.dce)return;C._onLog&&C._onLog("_registerDCEControler()");const e=this.dce;this._dceControler=e._createControler();const t=this._dceControler;t.register(this),t.setDisiredValue(this,"refreshInterval",200),t.setDisiredValue(this,"maxCvsSideLength",this._maxCvsSideLength);try{ResizeObserver}catch(e){"ReferenceError"===e.name&&window&&(window.ResizeObserver=void 0)}const s=e.getUIElement(),r=this.dce.constructor;if("@engineResourcePath/dce.ui.html"===r._defaultUIElementURL)try{s?s===t._innerSetUI&&(await e.setUIElement(`${r.engineResourcePath}dce.ui.html`),t._innerSetUI=e.getUIElement()):(await e.setUIElement(`${r.engineResourcePath}dlr.ui.html`),t._innerSetUI=e.getUIElement())}catch(t){await e.setUIElement(r.defaultUIElementURL)}else s||await e.setUIElement(r.defaultUIElementURL);this.callbackCameraChange=()=>{this._drawResults(null),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0},this.callbackResolutionChange=()=>{this._drawResults(null),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0},this.callbackCameraClose=()=>{this.stopScanning(!0),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0,this._bPauseScan=!1},this.callbackSingleFrameAcquired=async e=>{let t=await this._recognize_DCEFrame(e,{bCopyData:!1}),s=null;if(t&&t.length){const{sx:r,sy:i,width:n,height:a,_sWidth:o,_sHeight:l}=e;s=t.map((e=>({lineResults:e.lineResults.map((e=>({location:JSON.parse(JSON.stringify(e.location))})))}))),C.recalculateResultLocation(s,r,i,o,l,n,a)}this._drawResults(s),await this.clearMapDecodeRecord();for(let e of t)delete e.bUnduplicated;if(this.onImageRead&&this.dce.isOpen()&&!this._bPauseScan){let e=this._cloneDecodeResults(t);this.onImageRead(e)}if(this.onUniqueRead&&this.dce.isOpen()&&!this._bPauseScan)for(let e of t)for(let t of e.lineResults)this.onUniqueRead(t.text,this._cloneDecodeResults(t));if(this.onMRZRead&&this.dce.isOpen()&&!this._bPauseScan){if(["MRZ","passportMRZ","visaMRZ","idcardMRZ"].includes(this.currentSettingsTemplate)){let e=this._cloneDecodeResults(t);this._filterVideoModeMrzResult(e)}}if(this.onVINRead&&this.dce.isOpen()&&!this._bPauseScan){if(["VIN","VIN_NA"].includes(this.currentSettingsTemplate)){let e=this._cloneDecodeResults(t);if(e.length){let s="";for(let r of e)for(let e of r.lineResults){if(18===e.characterResults.length){e.characterResults[0].characterHConfidence>e.characterResults[17].characterHConfidence?e.characterResults.pop():e.characterResults.shift()}else if(19===e.characterResults.length){let t=e.characterResults[0].characterHConfidence+e.characterResults[1].characterHConfidence,s=e.characterResults[17].characterHConfidence+e.characterResults[18].characterHConfidence,r=e.characterResults[0].characterHConfidence+e.characterResults[18].characterHConfidence,i=Math.min(t,s,r);i===t?e.characterResults.splice(0,2):i===s?e.characterResults.splice(17,2):i===r&&(e.characterResults.pop(),e.characterResults.shift())}for(let t of e.characterResults)s+=t.characterH;this.onVINRead(s,t[0].lineResults[0])}}}}},e.on("cameraChange",this.callbackCameraChange),e.on("resolutionChange",this.callbackResolutionChange),e.on("cameraClose",this.callbackCameraClose),e.on("singleFrameAcquired",this.callbackSingleFrameAcquired)}_logoutDCEControler(){this.dce&&this._dceControler&&(C._onLog&&C._onLog("_logoutDCEControler()"),this._dceControler.logout(this),this.dce.off("cameraChange",this.callbackCameraChange),this.dce.off("resolutionChange",this.callbackResolutionChange),this.dce.off("cameraClose",this.callbackCameraClose),this.dce.off("singleFrameAcquired",this.callbackSingleFrameAcquired),this._dceControler=null,this._dlrDrawingLayer=null,this.dce=null)}async setImageSource(e,t){if(null==e)return this.imgSource=null,this._logoutDCEControler(),void(this._drawingItemNamespace=null);if(e&&e.isCameraEnhancer)this.dce=e,await this._registerDCEControler(),this.imgSource=null;else{if(!L(e))throw new Error("Invalid value.");this._logoutDCEControler(),this.imgSource=e}t&&t.resultsHighlightBaseShapes&&(this._drawingItemNamespace=t.resultsHighlightBaseShapes)}static async loadWasm(){if(this._pLoad.isEmpty){let{lt:e,l:t,ls:r,sp:i,rmk:n}=(e=>{const t=e;if(t._pLoad.isEmpty){let e,r,i=t._license||"",n=JSON.parse(JSON.stringify(t._licenseServer)),a=t._sessionPassword,o=0;if(i.startsWith("t")||i.startsWith("f"))o=0;else if(0===i.length||i.startsWith("P")||i.startsWith("L")||i.startsWith("Y")||i.startsWith("A"))o=1;else{o=2;const t=i.indexOf(":");if(-1!=t&&(i=i.substring(t+1)),i.startsWith("DLS2")){let t;try{let e=i.substring(4);e=atob(e),t=JSON.parse(e)}catch(e){throw new Error("Format Error: The license string you specified is invalid, please check to make sure it is correct.")}if(i=t.handshakeCode?t.handshakeCode:t.organizationID?t.organizationID:"","number"==typeof i&&(i=JSON.stringify(i)),0===n.length){let e=[];t.mainServerURL&&(e[0]=t.mainServerURL),t.standbyServerURL&&(e[1]=t.standbyServerURL),n=R(e)}!a&&t.sessionPassword&&(a=t.sessionPassword),e=t.remark}("200001"===i||i.startsWith("200001-"))&&(n&&n.length||(i="")),i||(o=1)}if(o&&(s.crypto||(r="Please upgrade your browser to support online key."),s.crypto.subtle||(r="Require https to use online key in this browser.")),r){if(1!==o)throw new Error(r);o=0,console.warn(r),t._lastErrorCode=-1,t._lastErrorString=r}return 1===o&&(i="",console.warn("Applying for a public trial license ...")),{lt:o,l:i,ls:n,sp:a,rmk:e}}throw new Error("Can't preprocess license again"+g)})(C);this._pLoad.task=async(s,a)=>{let l=C.engineResourcePath+C._workerName;C.engineResourcePath.startsWith(location.origin)||(l=await fetch(l).then((e=>e.blob())).then((e=>URL.createObjectURL(e)))),C._dlrWorker=new Worker(l),C._dlrWorker.onerror=e=>{let t=new Error(e.message);a(t)},C._dlrWorker.onmessage=async t=>{let r=t.data?t.data:t;switch(r.type){case"log":C._onLog&&C._onLog(r.message);break;case"load":{r.message&&(r.message=r.message.replace("(https://www.dynamsoft.com/purchase-center/)","(https://www.dynamsoft.com/store/dynamsoft-label-recognizer/#javascript)"));let t,i=!1;1===e&&(i=!0),r.success?(C._dlrWorker.onerror=null,C._version=r.version+"(JS "+C._jsVersion+"."+C._jsEditVersion+")",C._onLog&&C._onLog("load dlr worker success"),r.message&&console.warn(r.message)):(t=new Error(r.message),t.stack=r.stack+"\n"+t.stack,i||111==r.ltsErrorCode&&-1!=r.message.toLowerCase().indexOf("trial license")&&(i=!0)),i&&C.showDialog(r.success?"warn":"error",r.message),r.success?s():a(t);break}case"task":{let e=r.id,t=r.body;try{C._taskCallbackMap.get(e)(t),C._taskCallbackMap.delete(e)}catch(t){throw C._taskCallbackMap.delete(e),t}break}case"event":"resourcesLoadStarted"===r.body.type?C.onResourcesLoadStarted&&setTimeout((()=>C.onResourcesLoadStarted(r.body.resourcesPath)),0):"resourcesLoadProgress"===r.body.type?C.onResourcesLoadProgress&&setTimeout((()=>C.onResourcesLoadProgress(r.body.resourcesPath,{loaded:r.body.loaded,total:r.body.total})),0):"resourcesLoaded"===r.body.type&&C.onResourcesLoaded&&setTimeout((()=>C.onResourcesLoaded(r.body.resourcesPath)),0);break;default:C._onLog&&C._onLog(t)}},C._dlrWorker.postMessage({type:"loadWasm",engineResourcePath:C.engineResourcePath,bd:C._bWasmDebug,v:C._jsVersion,brtk:!!e,bptk:1===e,l:t,dm:location.origin.startsWith("http")?location.origin:"https://localhost",os:o,fn:C.deviceFriendlyName,ls:r,sp:i,rmk:n})}}await this._pLoad}static async showDialog(e,t){await(async(e,t,s)=>{if(!e._bNeverShowDialog)try{let r=await fetch(e.engineResourcePath+"dls.license.dialog.html");if(!r.ok)throw Error("Get license dialog fail. Network Error: "+r.statusText);let i=await r.text();if(!i.trim().startsWith("<"))throw Error("Get license dialog fail. Can't get valid HTMLElement.");let n=document.createElement("div");n.innerHTML=i;let a=[];for(let e=0;e<n.childElementCount;++e){let t=n.children[e];t instanceof HTMLStyleElement&&(a.push(t),document.head.append(t))}let o=1==n.childElementCount?n.children[0]:n;o.remove();let l,c,h,u,d,g=[o],_=o.children;for(let e of _)g.push(e);for(let e=0;e<g.length;++e)for(let t of g[e].children)g.push(t);for(let e of g)if(!l&&e.classList.contains("dls-license-mask"))l=e,e.addEventListener("click",(t=>{if(e==t.target){o.remove();for(let e of a)e.remove()}}));else if(!c&&e.classList.contains("dls-license-icon-close"))c=e,e.addEventListener("click",(()=>{o.remove();for(let e of a)e.remove()}));else if(!h&&e.classList.contains("dls-license-icon-error"))h=e,"error"!=t&&e.remove();else if(!u&&e.classList.contains("dls-license-icon-warn"))u=e,"warn"!=t&&e.remove();else if(!d&&e.classList.contains("dls-license-msg-content")){d=e;let t=s;for(;t;){let s=t.indexOf("["),r=t.indexOf("]",s),i=t.indexOf("(",r),n=t.indexOf(")",i);if(-1==s||-1==r||-1==i||-1==n){e.appendChild(new Text(t));break}s>0&&e.appendChild(new Text(t.substring(0,s)));let a=document.createElement("a"),o=t.substring(s+1,r);a.innerText=o;let l=t.substring(i+1,n);a.setAttribute("href",l),a.setAttribute("target","_blank"),e.appendChild(a),t=t.substring(n+1)}}document.body.appendChild(o)}catch(t){e._onLog&&e._onLog(t.message||t)}})(this,e,t)}static async createInstanceInWorker(){return await this.loadWasm(),await new Promise(((e,t)=>{let s=this._nextTaskID++;this._taskCallbackMap.set(s,(s=>{if(s.success)return e(s.instanceID);{let e=new Error(s.message);return e.stack=s.stack+"\n"+e.stack,t(e)}})),this._dlrWorker.postMessage({type:"createInstance",id:s,bScanner:!1})}))}static async createInstance(e){let t=new C;return t._instanceID=await this.createInstanceInWorker(),e&&e.runtimeSettings&&t.updateRuntimeSettingsFromString(e.runtimeSettings),t}async recognize(e,t){let s;return C._onLog&&C._onLog("recognize(source: any, modelName?: string)"),C._onLog&&(this._timeStartRecognize=Date.now()),t=t||{},e instanceof Blob?s=await this._recognize_Blob(e,t):e instanceof ArrayBuffer?s=await this._recognize_ArrayBuffer(e,t):e instanceof Uint8Array||e instanceof Uint8ClampedArray?s=await this._recognize_Uint8Array(e,t):e instanceof HTMLImageElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?s=await this._recognize_Image(e,t):e instanceof HTMLCanvasElement?s=await this._recognize_Canvas(e,t):e instanceof HTMLVideoElement?s=await this._recognize_Video(e,t):"string"==typeof e?s="data:image/"==e.substring(0,11)?await this._recognize_Base64(e,t):await this._recognize_Url(e,t):b(e)?(t.bCopyData=!0,s=await this._recognize_DCEFrame(e,t)):E(e)?(t.bCopyData=!0,s=await this._recognize_DSImage(e,t)):s=await Promise.reject(TypeError("'_recognize(source, config)': Type of 'source' should be 'Blob', 'ArrayBuffer', 'Uint8Array', 'HTMLImageElement', 'HTMLCanvasElement', 'HTMLVideoElement', 'string(base64 with image mime)', 'string(url)' or 'object(dceFrame)'.")),this._filterResult(s)||s}async recognizeBase64String(e,t){let s={};t&&(s.modelName=t);let r=await this._recognize_Base64(e,s);return this._filterResult(r)||r}async recognizeUrl(e,t){let s={};t&&(s.modelName=t);let r=await this._recognize_Url(e,s);return this._filterResult(r)||r}async recognizeBuffer(e,t,s,r,i,n){let a;return C._onLog&&C._onLog("recognizeBuffer(buffer,width,height,stride,format)"),C._onLog&&(this._timeStartRecognize=Date.now()),e instanceof Uint8Array||e instanceof Uint8ClampedArray?a=await this._recognizeBuffer_Uint8Array(e,t,s,r,i,n):e instanceof ArrayBuffer?a=await this._recognizeBuffer_Uint8Array(new Uint8Array(e),t,s,r,i,n):e instanceof Blob&&(a=await this._recognizeBuffer_Blob(e,t,s,r,i,n)),this._filterResult(a)||a}_filterResult(e){if(!e.length)return e;if(["MRZ","passportMRZ","visaMRZ","idcardMRZ"].includes(this.currentSettingsTemplate)){const t=this._filterMrzResult(e);return t.length&&this._verifyCheckDigit(t[0].lineResults),t}["VIN","VIN_NA"].includes(this.currentSettingsTemplate)&&(this._filterVinResult(e),e.length&&this._verifyCheckDigit(e[0].lineResults))}_filterMrzResult(e){let t=[];if(0===e.length)return[];for(let s=0;s<e.length;s++){if(t.push(JSON.parse(JSON.stringify(e[s]))),t[s].lineResults=[],e[s].lineResults.length>=2){if(e[s].lineResults[e[s].lineResults.length-1].text.length>30&&e[s].lineResults.length>=2){for(let r=e[s].lineResults.length-2;r<e[s].lineResults.length;r++)t[s].lineResults.push(e[s].lineResults[r]);return t}if(e[s].lineResults[e[s].lineResults.length-1].text.length<=30&&e[s].lineResults.length>=3){for(let r=e[s].lineResults.length-3;r<e[s].lineResults.length;r++)t[s].lineResults.push(e[s].lineResults[r]);return t}return[]}return[]}}_filterVinResult(e){let t="";if(e.length)for(let s of e)for(let e of s.lineResults){if(18===e.characterResults.length){e.characterResults[0].characterHConfidence>e.characterResults[17].characterHConfidence?e.characterResults.pop():e.characterResults.shift()}else if(19===e.characterResults.length){let t=e.characterResults[0].characterHConfidence+e.characterResults[1].characterHConfidence,s=e.characterResults[17].characterHConfidence+e.characterResults[18].characterHConfidence,r=e.characterResults[0].characterHConfidence+e.characterResults[18].characterHConfidence,i=Math.min(t,s,r);i===t?e.characterResults.splice(0,2):i===s?e.characterResults.splice(17,2):i===r&&(e.characterResults.pop(),e.characterResults.shift())}for(let s of e.characterResults)t+=s.characterH;e.text=t}}_verifyCheckDigit(e){const t=this._getMrzType(e);e.length>=3&&["MRZ","idcardMRZ"].includes(this.currentSettingsTemplate)&&(this._idCardUpperLine=e[0].text);const s=e=>!!e&&(["MRZ","passportMRZ"].includes(this.currentSettingsTemplate)&&"passport"===t?/[0-9]/.test(e)?this._checkValidMRP(e):null:["MRZ","idcardMRZ"].includes(this.currentSettingsTemplate)&&"idcard"===t?/[0-9]/.test(e)?this._checkValidIDCard(e,this._idCardUpperLine):null:["MRZ","visaMRZ"].includes(this.currentSettingsTemplate)&&"visa"===t?/[0-9]/.test(e)?this._checkValidMRV(e):null:!!["VIN","VIN_NA"].includes(this.currentSettingsTemplate)&&this._checkValidVIN(e));for(let t of e)t.isCheckDigitMatched=s(t.text)}_getMrzType(e){const t=e[0].text.length,s=e.length,r=e[0].text[0],i=["A","C","I"].includes(r);return 44===t&&2===s&&"P"===r?"passport":44===t&&2===s&&"V"===r||36===t&&2===s&&"V"===r?"visa":36===t&&2===s&&i||30===t&&3===s&&i?"idcard":null}async _recognizeBuffer_Uint8Array(e,t,s,r,i,n){return await new Promise(((a,o)=>{let l=C._nextTaskID++;C._taskCallbackMap.set(l,(e=>{if(e.success){let t,s=C._onLog?Date.now():0;this._lastInnerDecodeDuration=e.duration;try{t=this._handleRetJsonString(e.decodeReturn)}catch(e){return o(e)}if(C._onLog){let e=Date.now();C._onLog("DLR getting message from worker timestamp: "+s),C._onLog("From DLR starting recognizing to entering worker costs: "+(this._timeEnterInnerDLR-this._timeStartRecognize)),C._onLog("From DLR entering worker to returning message from worker costs: "+(s-this._timeEnterInnerDLR)),C._onLog("Handling results from DBR worker costs: "+(e-s)),C._onLog("Total recognize image costs: "+(e-this._timeStartRecognize))}return a(t)}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,o(t)}})),C._onLog&&(this._timeEnterInnerDLR=Date.now()),C._onLog&&C._onLog("Sending buffer to worker timestamp:"+this._timeEnterInnerDLR),C._dlrWorker.postMessage({type:"recognizeByBuffer",id:l,instanceID:this._instanceID,body:{config:n,imageData:{bytes:e,length:r*s,width:t,height:s,stride:r,format:i}}},[e.buffer]),C._onLog&&n&&n.timeStamp&&C._onLog("Delay of recognizing image: "+(this._timeEnterInnerDLR-n.timeStamp))}))}async _recognizeBuffer_Blob(e,t,s,r,i,n){C._onLog&&C._onLog("_recognizeBuffer_Blob(buffer,width,height,stride,format)");const a=e.arrayBuffer?await e.arrayBuffer():await new Promise(((t,s)=>{let r=new FileReader;r.readAsArrayBuffer(e),r.onload=()=>{t(r.result)},r.onerror=()=>{s(r.error)}}));return await this._recognizeBuffer_Uint8Array(new Uint8Array(a),t,s,r,i,n)}async _recognizeFileInMemory_Uint8Array(e,t){return await new Promise(((s,r)=>{let i=C._nextTaskID++;C._taskCallbackMap.set(i,(e=>{if(e.success){let t;try{t=this._handleRetJsonString(e.decodeReturn)}catch(e){return r(e)}return s(t)}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,r(t)}})),C._dlrWorker.postMessage({type:"recognizeFileInMemory",id:i,instanceID:this._instanceID,body:{config:t,bytes:e}})}))}async _recognize_Blob(e,t){C._onLog&&C._onLog("_recognize_Blob(blob: Blob)");let s=null,r=null;if("undefined"!=typeof createImageBitmap)try{s=await createImageBitmap(e)}catch(e){}s||(r=await function(e){return new Promise(((t,s)=>{let r=URL.createObjectURL(e),i=new Image;i.dlrObjUrl=r,i.src=r,i.onload=()=>{URL.revokeObjectURL(r),t(i)},i.onerror=e=>{s(new Error("Can't convert blob to image : "+(e instanceof Event?e.type:e)))}}))}(e));let i=await this._recognize_Image(s||r,t);return s&&s.close(),i}async _recognize_ArrayBuffer(e,t){return await this._recognize_Blob(new Blob([e]),t)}async _recognize_Uint8Array(e,t){return await this._recognize_Blob(new Blob([e]),t)}async _recognize_Image(e,t){C._onLog&&C._onLog("_recognize_Image(image: HTMLImageElement|ImageBitmap)"),t=t||{};let s,r,i=e instanceof HTMLImageElement?e.naturalWidth:e.width,n=e instanceof HTMLImageElement?e.naturalHeight:e.height,a=Math.max(i,n);if(a>this._maxCvsSideLength){let e=this._maxCvsSideLength/a;s=Math.round(i*e),r=Math.round(n*e)}else s=i,r=n;this.canvas||(this.canvas=document.createElement("canvas"));const o=this.canvas;o.width===s&&o.height===r||(o.width=s,o.height=r),o.ctx2d||(o.ctx2d=o.getContext("2d",{willReadFrequently:!0}));return o.ctx2d.drawImage(e,0,0,i,n,0,0,s,r),e.dlrObjUrl&&URL.revokeObjectURL(e.dlrObjUrl),await this._recognize_Canvas(o,t)}async _recognize_Canvas(e,t){if(C._onLog&&C._onLog("_recognize_Canvas(canvas:HTMLCanvasElement)"),e.crossOrigin&&"anonymous"!=e.crossOrigin)throw"cors";if(0===e.width||0===e.height)throw Error("The width or height of the 'canvas' is 0.");this.ifSaveOriginalImageInACanvas&&(this.oriCanvas=e,this.oriCanvasData=null);let s=(e.ctx2d||e.getContext("2d")).getImageData(0,0,e.width,e.height).data;return await this._recognizeBuffer_Uint8Array(s,e.width,e.height,4*e.width,S.IPF_ABGR_8888,t)}async _recognize_Video(e,t){if(C._onLog&&C._onLog("_recognize_Video(video)"),!(e instanceof HTMLVideoElement))throw TypeError("'_recognize_Video(video [, config] )': Type of 'video' should be 'HTMLVideoElement'.");if(e.crossOrigin&&"anonymous"!=e.crossOrigin)throw"cors";t=t||{};let s,r,i=e.videoWidth,n=e.videoHeight,a=Math.max(i,n);if(a>this._maxCvsSideLength){let e=this._maxCvsSideLength/a;s=Math.round(i*e),r=Math.round(n*e)}else s=i,r=n;this.canvas||(this.canvas=document.createElement("canvas"));const o=this.canvas;o.width===s&&o.height===r||(o.width=s,o.height=r),o.ctx2d||(o.ctx2d=o.getContext("2d"));return o.ctx2d.drawImage(e,0,0,i,n,0,0,s,r),await this._recognize_Canvas(o,t)}async _recognize_DCEFrame(e,t){if(C._onLog&&C._onLog("_recognize_DCEFrame(dceFrame)"),!b(e))return[];let s=[];this.ifSaveOriginalImageInACanvas&&(this.oriCanvas=null,this.oriCanvasData={width:e.width,height:e.height,colorMode:e.colorMode,data:new Uint8Array(e.data),toCanvas:e.toCanvas});const{width:r,height:i,colorMode:n,timeStamp:a}=e;let o;o=t&&t.bCopyData?new Uint8Array(e.data):e.data;let l=null;if(t?(l=JSON.parse(JSON.stringify(t)),l.timeStamp=a):l={timeStamp:a},"grey"===n)s=await this._recognizeBuffer_Uint8Array(o,r,i,r,S.IPF_GRAYSCALED,l);else if("rgba"===n)s=await this._recognizeBuffer_Uint8Array(o,r,i,4*r,S.IPF_ABGR_8888,l);else{if("bgra"!==n)throw new Error(`Color mode '${n}' is not supported to recognize.`);s=await this._recognizeBuffer_Uint8Array(o,r,i,4*r,S.IPF_ARGB_8888,l)}return s}async _recognize_DSImage(e,t){if(C._onLog&&C._onLog("_recognize_DSImage(dsImage)"),!E(e))return null;this.ifSaveOriginalImageInACanvas&&(this.oriCanvas=null,this.oriCanvasData={width:e.width,height:e.height,pixelFormat:e.pixelFormat.toLowerCase(),data:new Uint8Array(e.data),toCanvas:function(){const e=document.createElement("canvas");let t;switch(e.width=this.width,e.height=this.height,this.pixelFormat){case"grey":t=new Uint8ClampedArray(this.width*this.height*4);for(let e=0;e<t.length;e+=4)t[e]=this.data[e/4],t[e+1]=this.data[e/4],t[e+2]=this.data[e/4],t[e+3]=255;break;case"rgb":t=new Uint8ClampedArray(this.width*this.height*4);for(let e=0;e<t.length;e+=4)t[e]=this.data[e],t[e+1]=this.data[e+1],t[e+2]=this.data[e+2],t[e+3]=255;break;case"bgr":t=new Uint8ClampedArray(this.width*this.height*4);for(let e=0;e<t.length;e+=4)t[e]=this.data[e],t[e+1]=this.data[e+1],t[e+2]=this.data[e+2],t[e+3]=255;break;case"rgba":case"bgra":t=new Uint8ClampedArray(this.data);break;default:throw new Error("The content of 2D Canvas is currently limited to the sRGB color space.")}const s=new ImageData(t,this.width,this.height);return e.getContext("2d").putImageData(s,0,0),e}});const{width:s,height:r}=e;let i,n,a,o=e.pixelFormat.toLowerCase();switch(i=t&&t.bCopyData?new Uint8Array(e.data):e.data,o){case"grey":a=S.IPF_GRAYSCALED,n=s;break;case"rgb":a=S.IPF_BGR_888,n=3*s;break;case"bgr":a=S.IPF_RGB_888,n=3*s;break;case"rgba":a=S.IPF_ABGR_8888,n=4*s;break;case"bgra":a=S.IPF_ARGB_8888,n=4*s;break;default:throw new Error("The pixel format is not supported to recognize.")}return await this._recognizeBuffer_Uint8Array(i,s,r,n,a,t)}async _recognize_Base64(e,t){if(C._onLog&&C._onLog("_recognize_Base64(base64Str)"),"string"!=typeof e&&"object"!=typeof e)return Promise.reject("'_recognize_Base64(base64Str, config)': Type of 'base64Str' should be 'string'.");"data:image/"==e.substring(0,11)&&(e=e.substring(e.indexOf(",")+1));{let s=atob(e),r=s.length,i=new Uint8Array(r);for(;r--;)i[r]=s.charCodeAt(r);return await this._recognize_Blob(new Blob([i]),t)}}async _recognize_Url(e,t){if(C._onLog&&C._onLog("_recognize_Url(url)"),"string"!=typeof e&&"object"!=typeof e)throw TypeError("'_recognize_Url(url, config)': Type of 'url' should be 'string'.");{const s=await new Promise(((t,s)=>{const r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="blob",r.send(),r.onloadend=async()=>{t(r.response)},r.onerror=()=>{s(new Error("Network Error: "+r.statusText))}}));return await this._recognize_Blob(s,t)}}async _recognize_FilePath(e,t){throw C._onLog&&C._onLog("_recognize_FilePath(path)"),Error("'_recognize_FilePath(path, config)': The method is only supported in node environment.")}async resetRuntimeSettings(){return this.region=null,this._updateMinLtrSel(0),await new Promise(((e,t)=>{let s=C._nextTaskID++;C._taskCallbackMap.set(s,(s=>{if(s.success)return e();{let e=new Error(s.message);return e.stack=s.stack+"\n"+e.stack,t(e)}})),C._dlrWorker.postMessage({type:"resetRuntimeSettings",id:s,instanceID:this._instanceID})}))}async updateRuntimeSettingsFromString(e,t=!1){let s=0;if("string"==typeof e)if((e=e.trim()).startsWith("{"))e=JSON.parse(e),t||(this.currentSettingsTemplate=null);else{if(e.length>50)throw new Error("Error: preset longer than 50 letters.");const t=e.toLowerCase().split("-");if(t.length>2)throw new Error(`Error: '${e}' is not supported.`);if(t.includes("numberletter"))s=3,this.currentSettingsTemplate="numberLetter";else if(t.includes("numberuppercase"))s=3,this.currentSettingsTemplate="numberUppercase";else if(t.includes("number"))s=3,this.currentSettingsTemplate="number";else if(t.includes("letter"))s=3,this.currentSettingsTemplate="letter";else if(t.includes("passportmrz"))s=44,this.currentSettingsTemplate="passportMRZ";else if(t.includes("visamrz"))s=36,this.currentSettingsTemplate="visaMRZ";else if(t.includes("idcardmrz"))s=30,this.currentSettingsTemplate="idcardMRZ";else if(t.includes("mrz"))s=30,this.currentSettingsTemplate="MRZ";else if(t.includes("vin_na"))s=17,this.currentSettingsTemplate="VIN_NA";else if(t.includes("vin"))s=17,this.currentSettingsTemplate="VIN";else{if(!t.includes("cppdefault"))throw new Error(`Error: '${e}' is not supported.`);this.currentSettingsTemplate="cppdefault"}if(t.includes("video")){if(!this.dce)throw new Error("'CameraEnhancer' instance is required through 'setImageSource()' when using the 'video' prefix template.");this.region=null,this.dce.setScanRegion(this.presetVideoTemplateRegion)}else this.region=null,this.dce&&((r=this.dce.getScanRegion())&&0===r.regionLeft&&100===r.regionRight&&40===r.regionTop&&60===r.regionBottom&&!0===r.regionMeasuredByPercentage)&&this.dce.setScanRegion(null)}else{if("object"!=typeof e)throw TypeError("'updateRuntimeSettingsFromString(settings)': Type of 'settings' should be 'string' or 'PlainObject'.");t||(this.currentSettingsTemplate=null)}var r;if("object"==typeof e){const t=e.ReferenceRegionArray[0].Localization,r=t.FirstPoint?{localizationSourceType:w[t.SourceType],location:{points:[{x:t.FirstPoint[0],y:t.FirstPoint[1]},{x:t.SecondPoint[0],y:t.SecondPoint[1]},{x:t.ThirdPoint[0],y:t.ThirdPoint[1]},{x:t.FourthPoint[0],y:t.FourthPoint[1]}]},regionMeasuredByPercentage:t.MeasuredByPercentage}:null;r&&function(e){return w.LST_MANUAL_SPECIFICATION==e.localizationSourceType&&1==e.regionMeasuredByPercentage&&JSON.stringify([{x:0,y:100},{x:100,y:0},{x:100,y:100},{x:0,y:100}])===JSON.stringify(e.location.points)}(r)?this.region=null:this.region=r;const i=e.LabelRecognizerParameterArray[0].LineStringLengthRange;s=i?i[0]:0}return this._updateMinLtrSel(s),await new Promise(((t,s)=>{let r=C._nextTaskID++;C._taskCallbackMap.set(r,(e=>{if(e.success){try{this._handleRetJsonString(e.updateReturn)}catch(e){s(e)}return t()}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,s(t)}})),C._dlrWorker.postMessage({type:"updateRuntimeSettingsFromString",id:r,instanceID:this._instanceID,body:{settings:e}})}))}async outputRuntimeSettingsToString(){return await new Promise(((e,t)=>{let s=C._nextTaskID++;C._taskCallbackMap.set(s,(s=>{if(s.success)return e(s.results);{let e=new Error(s.message);return e.stack=s.stack+"\n"+e.stack,t(e)}})),C._dlrWorker.postMessage({type:"outputSettingsToString",id:s,instanceID:this._instanceID})}))}async updateReferenceRegionFromBarcodeResults(e){return await new Promise(((t,s)=>{let r=C._nextTaskID++;C._taskCallbackMap.set(r,(e=>{if(e.success)return t();{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,s(t)}})),C._dlrWorker.postMessage({type:"updateReferenceRegionFromBarcodeResults",id:r,instanceID:this._instanceID,body:{dbrTextResults:e}})}))}static async appendCaffeModelBuffer(e,t){return await new Promise(((s,r)=>{let i=C._nextTaskID++;C._taskCallbackMap.set(i,(e=>{if(e.success){try{return s()}catch(e){r(e)}return s()}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,r(t)}})),C._dlrWorker.postMessage({type:"appendCaffeModelBuffer",id:i,body:{name:e,folderUrl:t}})}))}static async eraseCaffeModelByName(e){return await new Promise(((t,s)=>{let r=C._nextTaskID++;C._taskCallbackMap.set(r,(e=>{if(e.success)return t();{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,s(t)}})),C._dlrWorker.postMessage({type:"eraseCaffeModelByName",id:r,body:{name:e}})}))}static async eraseAllCaffeModels(){return await new Promise(((e,t)=>{let s=C._nextTaskID++;C._taskCallbackMap.set(s,(s=>{if(s.success)return e();{let e=new Error(s.message);return e.stack=s.stack+"\n"+e.stack,t(e)}})),C._dlrWorker.postMessage({type:"eraseAllCaffeModels",id:s})}))}static LabelRecognizerException(e,t){let s,r=A.UNKNOWN;return"number"==typeof e?(r=e,s=new Error(t)):s=new Error(e),s.code=r,s}_handleRetJsonString(e){let t=A;if(e.results){const t=this.drawRegionsultRecords,s={};for(let r=0;r<e.results.length;r++){let i=e.results[r];if(null!=i.exception){this._setWarnnedEx.has(i.exception)||(this._setWarnnedEx.add(i.exception),console.warn(i.exception));let e={};i.exception.split(";").forEach((t=>{let s=t.indexOf(":");e[t.substring(0,s)]=t.substring(s+1)})),i.exception=e}for(let e of i.lineResults){const r=e.text;if(s[r]=1,e.bUnduplicated){(t[r]=t[r]||[]).push(e)}else t[r]&&(t[r]=[e])}}if(e.records){const r=this.recognizeRecords=e.records;for(let e in t)r[e]||delete t[e];for(let e in t)s[e]||(t[e]=[])}else this.recognizeRecords={},this.drawRegionsultRecords={};return this._lastErrorCode=e.exception,this._lastErrorString=e.description,e.exception&&!this._setWarnnedEx.has(e.description)&&(this._setWarnnedEx.add(e.description),e.exception==A.LICENSE_INVALID||e.exception==A.LICENSE_EXPIRED?console.error(e.description):console.warn(e.description)),e.results}if(e.exception==t.OK)return e.data;throw C.LabelRecognizerException(e.exception,e.description)}async clearMapDecodeRecord(){return await new Promise(((e,t)=>{let s=C._nextTaskID++;C._taskCallbackMap.set(s,(s=>{if(s.success)return e();{let e=new Error(s.message);return e.stack=s.stack+"\n"+e.stack,t(e)}})),C._dlrWorker.postMessage({type:"clearMapDecodeRecord",id:s,instanceID:this._instanceID})}))}_bindUI(){this.dce&&(this._selMinLtr=this.dce._selMinLtr,this._optGotMinLtr=this.dce._optGotMinLtr,this.dce.singleFrameMode||this._selMinLtr&&this._selMinLtr.addEventListener("change",this._onMinLetterSelChange),this._updateMinLtrSel(this._minLetter))}_unbindUI(){this._selMinLtr&&this._selMinLtr.removeEventListener("change",this._onMinLetterSelChange),this._selMinLtr=null,this._optGotMinLtr=null}async getScanSettings(){return await new Promise(((e,t)=>{let s=C._nextTaskID++;C._taskCallbackMap.set(s,(s=>{if(s.success){let t=s.results;return t.intervalTime=this.intervalTime,t.whenToPlaySoundforSuccessfulRead=this.whenToPlaySoundforSuccessfulRead,t.soundOnSuccessfullRead=this.soundSource,t.whenToVibrateforSuccessfulRead=this.whenToVibrateforSuccessfulRead,t.vibrateDuration=this.vibrateDuration,t.captureAndRecognizeInParallel=this.captureAndRecognizeInParallel,e(t)}{let e=new Error(s.message);return e.stack+="\n"+s.stack,t(e)}})),C._dlrWorker.postMessage({type:"getScanSettings",id:s,instanceID:this._instanceID})}))}async updateScanSettings(e){if(!e)return;const t=JSON.parse(JSON.stringify(e));return t.hasOwnProperty("intervalTime")&&(t.intervalTime<0&&(t.intervalTime=0),this.intervalTime=t.intervalTime,delete t.intervalTime),t.hasOwnProperty("whenToPlaySoundforSuccessfulRead")&&(this.whenToPlaySoundforSuccessfulRead=t.whenToPlaySoundforSuccessfulRead,delete t.whenToPlaySoundforSuccessfulRead),t.hasOwnProperty("soundOnSuccessfullRead")&&(this.soundSource=t.soundOnSuccessfullRead,delete t.soundOnSuccessfullRead),t.hasOwnProperty("whenToVibrateforSuccessfulRead")&&(this.whenToVibrateforSuccessfulRead=t.whenToVibrateforSuccessfulRead,delete t.whenToVibrateforSuccessfulRead),t.hasOwnProperty("vibrateDuration")&&(this.vibrateDuration=t.vibrateDuration,delete t.vibrateDuration),t.hasOwnProperty("captureAndRecognizeInParallel")&&(this.captureAndRecognizeInParallel=t.captureAndRecognizeInParallel,delete t.captureAndRecognizeInParallel),await new Promise(((t,s)=>{let r=C._nextTaskID++;C._taskCallbackMap.set(r,(e=>{if(e.success)return t();{let t=new Error(e.message);return t.stack+="\n"+e.stack,s(t)}})),C._dlrWorker.postMessage({type:"updateScanSettings",id:r,instanceID:this._instanceID,body:{settings:e}})}))}_cloneDecodeResults(e){if(e instanceof Array){let t=[];for(let s of e)t.push(this._cloneDecodeResults(s));return t}{let t=e;return JSON.parse(JSON.stringify(t,((e,t)=>"oriVideoCanvas"==e||"searchRegionCanvas"==e?void 0:t)))}}async _loopReadVideo(){if(this.bDestroyed)return this.dce&&this._dceControler&&this._dceControler.setDisiredAction(this,"stopFetchingLoop"),void this._drawResults(null);if(this.dce&&!this.dce.isOpen())return this._drawResults(null),void await this.clearMapDecodeRecord();if(!this.dce&&!this.imgSource||this._bPauseScan)return C._onLog&&C._onLog("Scan is paused, or imageSource is not set. Ask in 1s."),await this.clearMapDecodeRecord(),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),void(this._loopReadVideoTimeoutId=setTimeout((()=>{this._loopReadVideo()}),this._intervalDetectVideoPause));C._onLog&&C._onLog("======= once read ======="),C._onLog&&(this._timeStartRecognize=Date.now());let e=null,t=null;if(this.dce)e=this._getVideoFrame();else if(this.imgSource&&(t=await this.imgSource.getImage(),!E(t)))throw new Error("Invalid DSImage.");if(!e&&!t)return C._onLog&&C._onLog("Get invalid frame."),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),void(this._loopReadVideoTimeoutId=setTimeout((()=>{this._loopReadVideo()}),0));(async()=>{let s=[];if(e){s=await this._recognize_DCEFrame(e,{bScanner:!0,bCopyData:!1});let t=null;if(s&&s.length){const{sx:r,sy:i,width:n,height:a,_sWidth:o,_sHeight:l}=e;t=s.map((e=>({lineResults:e.lineResults.map((e=>({location:JSON.parse(JSON.stringify(e.location))})))}))),C.recalculateResultLocation(t,r,i,o,l,n,a)}this._drawResults(t)}else t&&(s=await this._recognize_DSImage(t,{bScanner:!0,bCopyData:!1}));return s})().then((e=>{if(C._onLog&&C._onLog(e),this.dce&&this.captureAndRecognizeInParallel){let e=this.array_decodeFrameTimeCost,t=this.array_getFrameTimeCost;const s=()=>{let s=0;if(t&&t.length){let r=Math.min(...e),i=Math.max(...t);r&&i&&(s=r-i)}else s=0;return s>0?s:0};(()=>{for(;e.length>=5;)e.shift();e.push(this._lastInnerDecodeDuration)})(),this._intervalGetVideoFrame=s()+ +this.intervalTime}if((this.dce&&this.dce.isOpen()||this.imgSource)&&!this._bPauseScan){if(this.bPlaySoundOnSuccessfulRead&&e.length){let t=!1;if(!0===this.bPlaySoundOnSuccessfulRead||"frame"===this.bPlaySoundOnSuccessfulRead)t=!0;else if("unique"===this.bPlaySoundOnSuccessfulRead)for(let s of e)for(let e of s.lineResults)if(e.bUnduplicated){t=!0;break}t&&(this.beepSound.stop(),this.beepSound.play())}if(navigator.vibrate&&this.bVibrateOnSuccessfulRead&&e.length){let t=!1;if(!0===this.bVibrateOnSuccessfulRead||"frame"===this.bVibrateOnSuccessfulRead)t=!0;else if("unique"===this.bVibrateOnSuccessfulRead)for(let s of e)for(let e of s.lineResults)if(e.bUnduplicated){t=!0;break}if(t)try{navigator.vibrate(this.vibrateDuration)}catch(e){console.warn("Vibration not allowed. User interaction required: "+(e.message||e))}}if(this.onImageRead){let t=this._cloneDecodeResults(e);for(let e of t)for(let t of e.lineResults)t.bUnduplicated&&delete e.bUnduplicated;this.onImageRead(t)}if(this.onUniqueRead)for(let t of e)for(let e of t.lineResults)e.bUnduplicated&&this.onUniqueRead(e.text,this._cloneDecodeResults(e));if(this.onMRZRead){if(["MRZ","passportMRZ","visaMRZ","idcardMRZ"].includes(this.currentSettingsTemplate)){let t=this._cloneDecodeResults(e);this._filterVideoModeMrzResult(t)}}if(this.onVINRead){if(["VIN","VIN_NA"].includes(this.currentSettingsTemplate)){let t=this._cloneDecodeResults(e);if(t.length){let s=0,r=!1;this._vinResultArrayTimeoutId&&clearTimeout(this._vinResultArrayTimeoutId);let i="";for(let e of t)for(let t of e.lineResults){if(18===t.characterResults.length){let e=t.characterResults[9].location.points[0].x-t.characterResults[8].location.points[1].x;e<2&&(e=2);let s=t.characterResults[1].location.points[0].x-t.characterResults[0].location.points[1].x,r=t.characterResults[17].location.points[0].x-t.characterResults[16].location.points[1].x,i=2===e?3:e;if(s-e>=i&&r-e<i)t.characterResults.shift();else if(r-e>=i&&s-e<i)t.characterResults.pop();else{t.characterResults[0].characterHConfidence>t.characterResults[17].characterHConfidence?t.characterResults.pop():t.characterResults.shift()}}else if(19===t.characterResults.length){let e=t.characterResults[10].location.points[0].x-t.characterResults[9].location.points[1].x;e<2&&(e=2);let s,r,i,n=t.characterResults[1].location.points[0].x-t.characterResults[0].location.points[1].x,a=t.characterResults[18].location.points[0].x-t.characterResults[17].location.points[1].x,o=t.characterResults[2].location.points[0].x-t.characterResults[1].location.points[1].x,l=t.characterResults[17].location.points[0].x-t.characterResults[16].location.points[1].x,c=2===e?3:e;if("1"===t.characterResults[1].characterH||"1"===t.characterResults[2].characterH||"1"===t.characterResults[16].characterH||"1"===t.characterResults[17].characterH){for(let e=9;e<t.characterResults.length;e++)if("1"!==t.characterResults[e].characterH){i=t.characterResults[e].location.points[1].x-t.characterResults[e].location.points[0].x;break}"1"===t.characterResults[1].characterH&&(s=i-(t.characterResults[1].location.points[1].x-t.characterResults[1].location.points[0].x)+3),"1"===t.characterResults[2].characterH&&(s=i-(t.characterResults[2].location.points[1].x-t.characterResults[2].location.points[0].x)+3),"1"===t.characterResults[16].characterH&&(r=i-(t.characterResults[16].location.points[1].x-t.characterResults[16].location.points[0].x)+3),"1"===t.characterResults[17].characterH&&(r=i-(t.characterResults[17].location.points[1].x-t.characterResults[17].location.points[0].x)+3)}if(o-e>=(s||c)&&l-e<(r||c))t.characterResults.splice(0,2);else if(l-e>=(r||c)&&o-e<(s||c))t.characterResults.splice(17,2);else if(n>e&&a>e)t.characterResults.pop(),t.characterResults.shift();else{let e=t.characterResults[0].characterHConfidence+t.characterResults[1].characterHConfidence,s=t.characterResults[17].characterHConfidence+t.characterResults[18].characterHConfidence,r=t.characterResults[0].characterHConfidence+t.characterResults[18].characterHConfidence,i=Math.min(e,s,r);i===e?t.characterResults.splice(0,2):i===s?t.characterResults.splice(17,2):i===r&&(t.characterResults.pop(),t.characterResults.shift())}}for(let e of t.characterResults)i+=e.characterH}if(5===this._vinResultArray.length&&this._vinResultArray.shift(),this._vinResultArray.push(i),this._vinResultArray.length>=2)for(let t=0;t<this._vinResultArray.length;t++){for(let i=0;i<this._vinResultArray.length;i++)if(this._vinResultArray[t]===this._vinResultArray[i]&&(s++,2===s)){this.onVINRead(this._vinResultArray[t],e[0].lineResults[0]),r=!0;break}if(s=0,r)break}}else this._vinResultArrayTimeoutId=setTimeout((()=>{this._vinResultArray.shift()}),500)}}}this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this.intervalTime?this._loopReadVideoTimeoutId=setTimeout((()=>{this._loopReadVideo()}),this.intervalTime):this._loopReadVideo()})).catch((e=>{this.dce&&this._dceControler&&this._dceControler.setDisiredAction(this,"stopFetchingLoop"),C._onLog&&C._onLog(e.message||e),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout((()=>{this.dce&&(this.dce.startFetchingLoop(),this._dceControler&&this._dceControler.clearUserDisiredAction({user:this,actionName:"stopFetchingLoop"})),this._loopReadVideo()}),Math.max(this.intervalTime,1e3)),"platform error"==e.message||console.warn(e.message)}))}_filterVideoModeMrzResult(e){for(let t of e){let e="",s=[];t.lineResults.length>=2&&(t.lineResults[t.lineResults.length-1].text.length>30&&t.lineResults.length>=2?(s.push(t.lineResults[t.lineResults.length-2]),s.push(t.lineResults[t.lineResults.length-1])):t.lineResults[t.lineResults.length-1].text.length<=30&&t.lineResults.length>=3&&(s.push(t.lineResults[t.lineResults.length-3]),s.push(t.lineResults[t.lineResults.length-2]),s.push(t.lineResults[t.lineResults.length-1])));for(let t of s)e.length>0&&(e+="\n"),e+=t.text;e.length>0&&(this._verifyCheckDigit(s),this.onMRZRead(e,s))}}_getVideoFrame(){if(!this.dce)return null;let e;if(this.captureAndRecognizeInParallel){if(C._onLog&&C._onLog("Get frame in parallel."),this._dceControler&&this._dceControler.setDisiredValue(this,"loopInterval",this._intervalGetVideoFrame),!this.dce.numberOfFramesInBuffer)return this._dceControler&&this._dceControler.setDisiredValue(this,"loopInterval",0),null;e=this.dce.getFrameFromBuffer();const t=e=>{if(!e)return;let t=e.timeSpent,s=this.array_getFrameTimeCost;for(;s.length>=5;)s.shift();s.push(t)};t(e)}else C._onLog&&C._onLog("Get frame in serial."),this._dceControler&&this._dceControler.setDisiredAction(this,"stopFetchingLoop"),e=this.dce.getFrame();return e}_drawResults(e){if(!this.dce||this._bPauseScan||!this._drawingItemNamespace||!this._drawingItemNamespace.DT_Polygon)return;if(!this._dlrDrawingLayer){if(!this.dce.isOpen())return;this._dlrDrawingLayer=this.dce.getDrawingLayer(2)}const t=this._dlrDrawingLayer;e||(e=[]);let s=this._arrPolygons,r=0;for(let i of e)for(let e of i.lineResults){let i,n=e.location.points;s[r]?(i=s[r],t.hasDrawingItem(i)||t.addDrawingItem(i),i.set("vertices",[{x:n[0].x,y:n[0].y},{x:n[1].x,y:n[1].y},{x:n[2].x,y:n[2].y},{x:n[3].x,y:n[3].y}])):(i=new this._drawingItemNamespace.DT_Polygon([{x:n[0].x,y:n[0].y},{x:n[1].x,y:n[1].y},{x:n[2].x,y:n[2].y},{x:n[3].x,y:n[3].y}]),t.addDrawingItem(i),s[r]=i),r++}for(let e=r;e<s.length;e++)t.removeDrawingItem(s[e]);t.renderAll()}_checkValidVIN(e){if(!e||17!=e.length)return!1;const t=(e=>{const t=new Map([["A",1],["B",2],["C",3],["D",4],["E",5],["F",6],["G",7],["H",8],["J",1],["K",2],["L",3],["M",4],["N",5],["P",7],["R",9],["S",2],["T",3],["U",4],["V",5],["W",6],["X",7],["Y",8],["Z",9],["1",1],["2",2],["3",3],["4",4],["5",5],["6",6],["7",7],["8",8],["9",9]]),s=[8,7,6,5,4,3,2,10,0,9,8,7,6,5,4,3,2];let r=0;for(let i=0;i<e.length;i++){let n=t.get(e[i]);n&&(r+=n*s[i])}return r%11})(e);return t.toString()===e[8]}_checkValidMRP(e){if(!e||44!=e.length)return!1;const t=(e,t,s)=>{const r=new Map([["<",0],["0",0],["1",1],["2",2],["3",3],["4",4],["5",5],["6",6],["7",7],["8",8],["9",9],["A",10],["B",11],["C",12],["D",13],["E",14],["F",15],["G",16],["H",17],["I",18],["J",19],["K",20],["L",21],["M",22],["N",23],["O",24],["P",25],["Q",26],["R",27],["S",28],["T",29],["U",30],["V",31],["W",32],["X",33],["Y",34],["Z",35]]),i=[7,3,1];let n=0;for(let a=t,o=0;a<=s;a++){let t=r.get(e[a]);t&&(n+=t*i[o%3]),o++}return n%10},s=e.slice(0,10)+e.slice(13,20)+e.slice(21,43),r=t(e,0,8).toString(),i=t(e,13,18).toString(),n=t(e,21,26).toString(),a=t(e,28,41).toString(),o=t(s,0,s.length).toString();return r===e[9]&&i===e[19]&&n===e[27]&&a===e[42]&&o===e[43]}_checkValidMRV(e){if(!e||44!=e.length&&36!=e.length)return!1;const t=(e,t,s)=>{const r=new Map([["<",0],["0",0],["1",1],["2",2],["3",3],["4",4],["5",5],["6",6],["7",7],["8",8],["9",9],["A",10],["B",11],["C",12],["D",13],["E",14],["F",15],["G",16],["H",17],["I",18],["J",19],["K",20],["L",21],["M",22],["N",23],["O",24],["P",25],["Q",26],["R",27],["S",28],["T",29],["U",30],["V",31],["W",32],["X",33],["Y",34],["Z",35]]),i=[7,3,1];let n=0;for(let a=t,o=0;a<=s;a++){let t=r.get(e[a]);t&&(n+=t*i[o%3]),o++}return n%10},s=t(e,0,8).toString(),r=t(e,13,18).toString(),i=t(e,21,26).toString();return s===e[9]&&r===e[19]&&i===e[27]}_checkValidIDCard(e,t){if(!e||30!=e.length&&36!=e.length)return!1;const s=(e,t,s)=>{const r=new Map([["<",0],["0",0],["1",1],["2",2],["3",3],["4",4],["5",5],["6",6],["7",7],["8",8],["9",9],["A",10],["B",11],["C",12],["D",13],["E",14],["F",15],["G",16],["H",17],["I",18],["J",19],["K",20],["L",21],["M",22],["N",23],["O",24],["P",25],["Q",26],["R",27],["S",28],["T",29],["U",30],["V",31],["W",32],["X",33],["Y",34],["Z",35]]),i=[7,3,1];let n=0;for(let a=t,o=0;a<=s;a++){let t=r.get(e[a]);t&&(n+=t*i[o%3]),o++}return n%10};if(30===e.length){if(t&&e===t){return s(e,5,13).toString()===e[14]}if(t&&e!==t){const r=`${t.substring(5,30)}${e.substring(0,7)}${e.substring(8,15)}${e.substring(18,29)}`;return s(r,0,r.length-1).toString()===e[29]}}else if(36===e.length){const t=s(e,0,8).toString(),r=s(e,13,18).toString(),i=s(e,21,26).toString(),n=`${e.substring(0,10)}${e.substring(13,20)}${e.substring(21,28)}`,a=s(n,0,n.length-1).toString();return t===e[9]&&r===e[19]&&i===e[27]&&a===e[35]}}async startScanning(e){if(!this.dce&&!this.imgSource)throw new Error("'imageSource' is not set. call 'setImageSource()' before 'startScanning()'.");if(this._promiseStartScan&&this._promiseStartScan.isPending)return this._promiseStartScan;this._promiseStartScan=new p;let t=null;if(this.dce){if(this.dce.isOpen())e&&this.dce.appendAndShowUI(),t=JSON.parse(JSON.stringify(this.dce.playCallbackInfo));else if(t=await this.dce.open(e),!this._promiseStartScan)return null;this._bindUI(),this._dceControler&&(this._dceControler.clearUserDisiredAction({user:this,actionName:"close"}),this._dceControler.clearUserDisiredValue({property:"ifShowScanRegionLaser"}),this._dceControler.setDisiredValue(this,"ifShowScanRegionLaser",!0),this.dce.ifShowScanRegionLaser&&this.dce.showScanRegionLaser())}return this._bPauseScan=!1,this.dce&&this.dce.singleFrameMode||(this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout((()=>{this.dce&&(this.dce.startFetchingLoop(),this._dceControler&&this._dceControler.clearUserDisiredAction({user:this,actionName:"stopFetchingLoop"})),this._loopReadVideo()}),0)),this._promiseStartScan.resolve(t),t}stopScanning(e){this.dce&&(this._drawResults(null),this._unbindUI(),this._dceControler&&(this._dceControler.setDisiredValue(this,"ifShowScanRegionLaser",!1),this.dce.ifShowScanRegionLaser||this.dce.hideScanRegionLaser(),this._dceControler.setDisiredAction(this,"close",[e]))),this._bPauseScan=!0,this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0,this._promiseStartScan=null}pauseScanning(e){if(e&&e.keepResultsHighlighted||this._drawResults(null),this._bPauseScan=!0,this._vinResultArray=[],this.dce){if(this.dce.singleFrameMode)throw new Error("'pauseScanning()' is unavailable when property 'singleFrameMode' of the 'CameraEnhancer' instance is true.");this._dceControler&&(this._dceControler.setDisiredValue(this,"ifShowScanRegionLaser",!1),this.dce.ifShowScanRegionLaser||this.dce.hideScanRegionLaser(),this._dceControler.setDisiredAction(this,"stopFetchingLoop"))}}resumeScanning(){if(this._bPauseScan=!1,this.dce){if(this.dce.singleFrameMode)throw new Error("'resumeScanning()' is unavailable when property 'singleFrameMode' of the 'CameraEnhancer' instance is true.");this.dce.startFetchingLoop(),this._dceControler&&(this._dceControler.clearUserDisiredAction({user:this,actionName:"stopFetchingLoop"}),this._dceControler.clearUserDisiredValue({property:"ifShowScanRegionLaser"}),this._dceControler.setDisiredValue(this,"ifShowScanRegionLaser",!0),this.dce.ifShowScanRegionLaser&&this.dce.showScanRegionLaser())}}destroyContext(){if(!this.bDestroyed)return C._onLog&&C._onLog("destroy()"),this.bDestroyed=!0,!this.dce&&this._promiseStartScan||this.stopScanning(!0),this.setImageSource(null),new Promise(((e,t)=>{let s=C._nextTaskID++;C._taskCallbackMap.set(s,(s=>{if(s.success)return e();{let e=new Error(s.message);return e.stack=s.stack+"\n"+e.stack,t(e)}})),C._dlrWorker.postMessage({type:"destroy",id:s,instanceID:this._instanceID})}))}}C._jsVersion="2.2.31",C._jsEditVersion="20230728",C._version="loading...(JS "+C._jsVersion+"."+C._jsEditVersion+")",C._license=_,C._sessionPassword=f,C.browserInfo=o,C._pLoad=new p,C._workerName=`dlr-${C._jsVersion}.browser.worker.js`,C._engineResourcePath=d,C._licenseServer=[],C._deviceFriendlyName="",C._bWasmDebug=!1,C._nextTaskID=0,C._taskCallbackMap=new Map,C.onResourcesLoadStarted=null,C.onResourcesLoadProgress=null,C.onResourcesLoaded=null,C._lastErrorCode=0,C._lastErrorString="",C._defaultUIElementURL="@engineResourcePath/dlr.ui.html",function(e){e[e.GTM_INVERTED=1]="GTM_INVERTED",e[e.GTM_ORIGINAL=2]="GTM_ORIGINAL",e[e.GTM_AUTO=4]="GTM_AUTO",e[e.GTM_REV=2147483648]="GTM_REV",e[e.GTM_SKIP=0]="GTM_SKIP"}(y||(y={})),function(e){e[e.RPM_AUTO=1]="RPM_AUTO",e[e.RPM_GENERAL=2]="RPM_GENERAL",e[e.RPM_GENERAL_RGB_CONTRAST=4]="RPM_GENERAL_RGB_CONTRAST",e[e.RPM_GENERAL_GRAY_CONTRAST=8]="RPM_GENERAL_GRAY_CONTRAST",e[e.RPM_GENERAL_HSV_CONTRAST=16]="RPM_GENERAL_HSV_CONTRAST",e[e.RPM_REV=2147483648]="RPM_REV",e[e.RPM_SKIP=0]="RPM_SKIP"}(I||(I={}));export{A as EnumDLRErrorCode,y as EnumDLRGrayscaleTransformationMode,S as EnumDLRImagePixelFormat,I as EnumDLRRegionPredetectionMode,C as LabelRecognizer,b as isDCEFrame,E as isDSImage,L as isImageSource};
